<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victor Store - Painel Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variáveis de Cores */
        :root {
            --primary-bg-white: #F8F9FA; 
            --header-blue: #004b96; 
            --highlight-color: #6DE350; 
            --secondary-highlight-color: #007BFF; 
            --text-color-dark: #212B36; 
            --text-color-light: #F8F9FA; 
            --success-color: #28A745;
            --error-color: #DC3545;
            --shadow-medium: 0 8px 16px rgba(0, 0, 0, 0.1);
            --border-radius-base: 12px;
            --font-family-base: 'Poppins', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--primary-bg-white);
            color: var(--text-color-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background-color: var(--text-color-light);
            border-radius: var(--border-radius-base);
            box-shadow: var(--shadow-medium);
            padding: 30px;
        }
        
        /* Ajuste de container para a tela de remoção */
        #removal-screen.container {
            max-width: 650px;
            padding: 40px;
        }

        /* --- Títulos e Botões --- */
        h1 {
            color: var(--header-blue);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-submit {
            background-color: var(--highlight-color);
            color: var(--text-color-dark);
            margin-top: 20px;
        }

        .btn-submit:hover {
            background-color: #55d03d;
            transform: translateY(-1px);
        }
        
        .btn-logout {
            background-color: #6c757d;
            color: var(--text-color-light);
            margin-top: 20px;
        }
        
        .btn-logout:hover {
            background-color: #5a6268;
        }
        
        .btn-login {
            background-color: var(--header-blue);
            color: var(--text-color-light);
            margin-top: 20px;
        }
        .btn-login:hover {
            background-color: #003b7a;
            transform: translateY(-1px);
        }
        
        .btn-delete {
            background-color: var(--error-color);
            color: var(--text-color-light);
            margin-top: 30px;
        }
        .btn-delete:hover {
            background-color: #c9303e;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-highlight-color);
            color: var(--text-color-light);
        }
        .btn-secondary:hover {
            background-color: #0069d9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- Formulário e Inputs --- */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #CED4DA;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        /* --- Status --- */
        .status-message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .status-message.success {
            background-color: #d4edda;
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-message.error {
            background-color: #f8d7da;
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        /* --- Telas de Estado --- */
        #auth-screen, #admin-form-screen, #loading-screen, #removal-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
        }
        
        #admin-form-screen {
            display: none; /* Inicia escondido */
        }
        
        #loading-screen {
            font-size: 1.2rem;
            color: var(--header-blue);
            min-height: 200px; 
            justify-content: center;
            display: none;
        }
        
        #auth-screen {
            padding: 20px 0;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Estilos para a lista de remoção */
        #content-list {
            list-style: none;
            padding: 0;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #CED4DA;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .content-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #E9ECEF;
            text-align: left;
        }
        
        .content-item:last-child {
            border-bottom: none;
        }
        
        .content-item input[type="checkbox"] {
            margin-right: 15px;
            min-width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .item-details {
            flex-grow: 1;
        }
        
        .item-details strong {
            display: block;
            font-weight: 600;
            color: var(--text-color-dark);
        }
        
        .item-details span {
            font-size: 0.85rem;
            color: #6c757d;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="container" id="main-container">
        <h1>Victor Store - Painel Admin</h1>

        <div id="loading-screen" style="display: flex;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            <p style="margin-top: 15px;">Aguarde...</p>
        </div>
        
        <div id="auth-screen" style="display: none;">
            <p style="margin-bottom: 20px; font-weight: 500;">Entre com a senha de acesso:</p>
            <form id="password-login-form" style="width: 100%;">
                <div class="form-group">
                    <label for="admin-password">Senha</label>
                    <input type="password" id="admin-password" placeholder="Digite a senha" required>
                </div>
                <button type="submit" class="btn btn-login" id="login-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                    Entrar
                </button>
            </form>
            <div id="login-status-message" class="status-message"></div>
        </div>

        <div id="admin-form-screen">
            <div style="font-weight: 600; margin-bottom: 20px; color: var(--highlight-color);" id="welcome-message">Bem-vindo(a) de volta!</div>
            
            <form id="content-form">
                
                <div class="form-group">
                    <label for="content-type">Tipo de Conteúdo Principal</label>
                    <select id="content-type" required>
                        <option value="">-- Selecione o Tipo --</option>
                        <option value="jogo">Jogo</option>
                        <option value="app_geral">App (Geral)</option>
                        <option value="musica">Música</option>
                        <option value="filme_serie">Filme/Série</option>
                        <option value="frp">FRP (Ferramentas de Desbloqueio)</option>
                        <option value="software">Software (PC/Outros)</option>
                    </select>
                </div>

                <div class="form-group" id="category-group" style="display: none;">
                    <label for="content-category">Categoria Específica</label>
                    <select id="content-category" required>
                        <option value="">-- Selecione a Categoria --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="content-name">Nome do Item</label>
                    <input type="text" id="content-name" placeholder="Ex: App de Editor de Fotos ou Música Nova" required>
                </div>

                <div class="form-group">
                    <label for="content-description">Descrição Curta (Máx 50 caracteres)</label>
                    <input type="text" id="content-description" placeholder="Ex: O melhor app de edição" maxlength="50" required>
                </div>
                
                <div class="form-group">
                    <label for="content-full-description">Descrição Completa</label>
                    <textarea id="content-full-description" rows="5" placeholder="Descrição detalhada para a página de detalhes do item." required></textarea>
                </div>

                <div class="form-group">
                    <label for="download-link">Link de Download (APK ou Música)</label>
                    <input type="url" id="download-link" placeholder="Ex: https://link.para.o.apk/musica.mp3" required>
                </div>

                <div class="form-group">
                    <label for="image-link">Link da Imagem/Ícone</label>
                    <input type="url" id="image-link" placeholder="Ex: https://link.para.o.icone/imagem.png" required>
                </div>

                <button type="submit" class="btn btn-submit" id="submit-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 15-4-2-7 15-2-4 15-7 2-4-7-15z"/></svg>
                    Enviar para Victor Store
                </button>
            </form>
            
            <div id="status-message" class="status-message"></div>
            
            <div style="margin-top: 30px; display: flex; gap: 10px;">
                <button class="btn btn-secondary" id="open-removal-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M15 6V4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v2"/></svg>
                    Sacar Cenas (Excluir)
                </button>
            </div>
            
            <button class="btn btn-logout" id="logout-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                Voltar para o Login
            </button>
        </div>
        
    </div>
    
    <div class="container" id="removal-screen" style="display: none;">
        <h1>Remover Conteúdo da Victor Store</h1>
        
        <p style="margin-bottom: 20px; font-weight: 500;">Selecione os itens que deseja excluir permanentemente:</p>
        
        <div id="removal-status-message" class="status-message"></div>
        
        <ul id="content-list">
            </ul>

        <button class="btn btn-delete" id="delete-selected-btn">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-square"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
            Excluir Itens Selecionados
        </button>

        <button class="btn btn-logout" id="close-removal-btn" style="margin-top: 10px;">
             <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            Voltar para o Painel
        </button>
        
    </div>
    
    <script type="module">
        
        // --- CONFIGURAÇÃO E IMPORTS FIREBASE ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc,
            serverTimestamp,
            getDocs, // Adicionado para listar
            deleteDoc, // Adicionado para excluir
            doc // Adicionado para referenciar documentos
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
        
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAqUbFJRI1CplOQptliKmVZH90LB2AlZus",
            authDomain: "victor-store-42568.firebaseapp.com",
            projectId: "victor-store-42568",
            storageBucket: "victor-store-42568.firebasestorage.app",
            messagingSenderId: "977015403689",
            appId: "1:977015403689:web:724a68bf4f7ff27f3065b8"
        };
        
        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const contentCollectionRef = collection(db, 'content');

        // --- REFERÊNCIAS DOM ---
        const mainContainer = document.getElementById('main-container');
        const removalScreen = document.getElementById('removal-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const authScreen = document.getElementById('auth-screen');
        const adminFormScreen = document.getElementById('admin-form-screen');
        const passwordLoginForm = document.getElementById('password-login-form');
        const adminPasswordInput = document.getElementById('admin-password');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const contentForm = document.getElementById('content-form');
        const submitBtn = document.getElementById('submit-btn');
        const statusMessage = document.getElementById('status-message');
        const loginStatusMessage = document.getElementById('login-status-message');
        const welcomeMessage = document.getElementById('welcome-message');
        
        // DOM para remoção
        const openRemovalBtn = document.getElementById('open-removal-btn');
        const closeRemovalBtn = document.getElementById('close-removal-btn');
        const contentList = document.getElementById('content-list');
        const deleteSelectedBtn = document.getElementById('delete-selected-btn');
        const removalStatusMessage = document.getElementById('removal-status-message');


        // Campos do Formulário
        const contentType = document.getElementById('content-type');
        const contentName = document.getElementById('content-name');
        const contentDescription = document.getElementById('content-description');
        const contentFullDescription = document.getElementById('content-full-description');
        const downloadLink = document.getElementById('download-link');
        const imageLink = document.getElementById('image-link');
        // NOVOS CAMPOS PARA CATEGORIAS DINÂMICAS
        const categoryGroup = document.getElementById('category-group');
        const contentCategory = document.getElementById('content-category');
        
        // Variável de estado da sessão
        let isAuthenticated = false;
        
        // SENHA ESTÁTICA CONFIGURADA
        const ADMIN_PASSWORD = "857629056"; 

        // --- NOVAS VARIÁVEIS DE CATEGORIA GLOBAIS ---
        
        // Objeto com todas as categorias detalhadas:
        const contentCategories = {
            // Categorias de JOGOS
            jogo: [
                "Ação/Aventura",
                "RPG/Estratégia",
                "Mundo Aberto (Open World)",
                "Esportes",
                "Corrida",
                "Simulação",
                "Arcade/Casual"
            ],
            // Categorias de APPS (Geral)
            app_geral: [
                "Entretenimento (Streaming/Vídeo)",
                "Redes Sociais/Comunicação",
                "Editores (Foto/Vídeo/Áudio)",
                "Produtividade/Trabalho",
                "Finanças/E-commerce",
                "Utilidades/Sistema"
            ],
            // Categorias de MÚSICA
            musica: [
                "Rap", 
                "Funk", 
                "Hip-Hop", 
                "Trap",
                "Pop",
                "Rock",
                "Sertanejo",
                "Gospel/Religioso",
                "Eletrônica",
                "R&B/Soul"
            ],
            // Categorias de FILMES/SÉRIES
            filme_serie: [
                "Ação",
                "Aventura",
                "Animação/Anime",
                "Comédia",
                "Drama",
                "Ficção Científica",
                "Terror/Horror",
                "Suspense/Thriller",
                "Romance",
                "Documentário"
            ],
            // Categorias de FRP (Ferramentas)
            frp: [
                "Desbloqueio de Conta Google (FRP)",
                "Remoção de Mi Account",
                "Ferramentas de Flash/Rom",
                "Drivers e Utilitários"
            ],
            // Categorias de Software (PC/Outros)
            software: [
                "Sistemas Operacionais (ISO/Img)",
                "Programas de Edição (PC)",
                "Utilitários de Sistema (PC)",
                "Drivers de Hardware",
                "Antivírus/Segurança"
            ]
        };
        
        // --- FUNÇÃO DE LÓGICA DE CATEGORIAS DINÂMICAS ---
        
        function updateCategories() {
            const selectedType = contentType.value;
            contentCategory.innerHTML = '<option value="">-- Selecione a Categoria --</option>'; // Limpa as opções anteriores
            contentCategory.value = ''; // Reseta o valor selecionado
        
            // Verifica se o tipo selecionado tem categorias definidas
            if (selectedType && contentCategories[selectedType]) {
                // Mostra o grupo de categorias
                categoryGroup.style.display = 'block';
                contentCategory.required = true;
        
                // Adiciona as novas opções
                contentCategories[selectedType].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    contentCategory.appendChild(option);
                });
                
            } else {
                // Esconde o grupo de categorias se não houver tipo selecionado ou subcategorias
                categoryGroup.style.display = 'none';
                contentCategory.required = false;
            }
        }
        
        // --- FUNÇÕES UTILITÁRIAS E DE EXIBIÇÃO ---
        
        function showScreen(screenId) {
            loadingScreen.style.display = 'none';
            authScreen.style.display = 'none';
            adminFormScreen.style.display = 'none';
            removalScreen.style.display = 'none';
            
            // Gerencia qual container deve ser exibido
            mainContainer.style.display = 'block';
            
            if (screenId === 'auth-screen') {
                authScreen.style.display = 'flex';
                adminPasswordInput.value = '';
                clearLoginStatus();
            } else if (screenId === 'admin-form-screen') {
                adminFormScreen.style.display = 'flex';
                updateCategories(); // Inicializa a lógica de categorias
            } else if (screenId === 'removal-screen') {
                mainContainer.style.display = 'none';
                removalScreen.style.display = 'flex';
                fetchContentList(); // Carrega a lista ao abrir a tela de remoção
            } else {
                loadingScreen.style.display = 'flex';
            }
            
            clearStatus();
            clearRemovalStatus();
        }

        function setStatus(message, type = 'error', target = statusMessage) {
            target.textContent = message;
            target.className = `status-message ${type}`;
            target.style.display = 'block';
        }
        
        function clearStatus() {
            statusMessage.style.display = 'none';
            statusMessage.textContent = '';
        }
        
        function clearLoginStatus() {
            loginStatusMessage.style.display = 'none';
            loginStatusMessage.textContent = '';
        }
        
        function clearRemovalStatus() {
            removalStatusMessage.style.display = 'none';
            removalStatusMessage.textContent = '';
        }
        
        // --- FUNÇÃO DE LOGIN POR SENHA ---
        
        async function handleLogin(e) {
            e.preventDefault();
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Verificando...`;
            clearLoginStatus();

            const enteredPassword = adminPasswordInput.value.trim();
            
            // Simula a verificação de login
            await new Promise(resolve => setTimeout(resolve, 500)); 

            if (enteredPassword === ADMIN_PASSWORD) {
                isAuthenticated = true;
                showScreen('admin-form-screen');
            } else {
                isAuthenticated = false;
                setStatus('Senha incorreta. Tente novamente.', 'error', loginStatusMessage);
            }

            loginBtn.disabled = false;
            loginBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg> Entrar`;
        }
        
        // --- LOGOUT (Voltar para a tela de senha) ---
        function handleLogout() {
            isAuthenticated = false;
            showScreen('auth-screen');
        }

        // --- SUBMISSÃO DO FORMULÁRIO (ADD DOC) ---
        
        contentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearStatus();
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            if (!isAuthenticated) {
                setStatus('Erro: Acesso não autorizado. Por favor, faça login.', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
                return;
            }

            // 1. Coleta e validação dos dados
            const newItem = {
                type: contentType.value, // Tipo Principal (jogo, musica, filme_serie, etc.)
                category: contentCategory.value, // Categoria Específica (Ação/Aventura, Rap, etc.)
                name: contentName.value.trim(),
                description: contentDescription.value.trim(),
                fullDescription: contentFullDescription.value.trim(),
                downloadLink: downloadLink.value.trim(),
                image: imageLink.value.trim(),
                createdAt: serverTimestamp(), 
                updatedAt: serverTimestamp(),
                submittedBy: 'Admin (Senha Estática)' 
            };
            
            // Validação agora inclui a Categoria, que é tornada 'required' dinamicamente
            if (newItem.type === '' || newItem.category === '' || newItem.name === '' || newItem.downloadLink === '' || newItem.image === '' || newItem.description === '' || newItem.fullDescription === '') {
                setStatus('Por favor, preencha todos os campos obrigatórios (Tipo de Conteúdo e Categoria Específica).', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
                return;
            }

            try {
                // 2. Adiciona o documento no Firestore
                const docRef = await addDoc(contentCollectionRef, newItem);

                // Mostra o Tipo Principal e a Categoria Específica no status de sucesso
                setStatus(`Conteúdo "${newItem.name}" [${newItem.type.toUpperCase()}/${newItem.category}] adicionado com sucesso! ID: ${docRef.id}`, 'success');
                contentForm.reset(); 
                updateCategories(); // Limpa e reseta o campo de categoria após o envio
                
            } catch (error) {
                console.error("Erro ao adicionar documento: ", error);
                if (error.code === 'permission-denied') {
                     setStatus(`ERRO: Permissão Negada. Confirme se as regras de segurança do Firestore permitem escrita.`, 'error');
                } else {
                    setStatus(`Erro ao salvar no Firestore: ${error.message}`, 'error');
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
            }
        });
        
        // --- FUNCIONALIDADE DE REMOÇÃO (Sacar Cenas) ---

        /** Carrega e renderiza a lista de conteúdo */
        async function fetchContentList() {
            clearRemovalStatus();
            contentList.innerHTML = '<li><p style="text-align: center; padding: 20px;">Carregando conteúdo...</p></li>';
            
            try {
                const snapshot = await getDocs(contentCollectionRef);
                
                if (snapshot.empty) {
                    contentList.innerHTML = '<li><p style="text-align: center; padding: 20px;">Nenhum item encontrado no banco de dados.</p></li>';
                    deleteSelectedBtn.disabled = true;
                    return;
                }
                
                let html = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const id = doc.id;
                    
                    // Exibe o Tipo Principal e a Categoria Específica para melhor identificação
                    const typeDisplay = data.type ? data.type.toUpperCase() : 'N/A';
                    const categoryDisplay = data.category ? ` - ${data.category}` : ''; 
                    
                    html += `
                        <li class="content-item">
                            <input type="checkbox" data-doc-id="${id}" id="item-${id}">
                            <div class="item-details">
                                <strong>${data.name}</strong>
                                <span>[${typeDisplay}]${categoryDisplay} | ID: ${id}</span>
                            </div>
                        </li>
                    `;
                });
                
                contentList.innerHTML = html;
                deleteSelectedBtn.disabled = false;
                
            } catch (error) {
                console.error("Erro ao listar documentos: ", error);
                contentList.innerHTML = '<li><p style="text-align: center; padding: 20px; color: var(--error-color);">Erro ao carregar lista. Verifique as regras de leitura do Firestore.</p></li>';
                deleteSelectedBtn.disabled = true;
                setStatus('Erro ao listar conteúdo.', 'error', removalStatusMessage);
            }
        }
        
        /** Exclui os itens selecionados */
        async function deleteSelectedContent() {
            const selectedCheckboxes = contentList.querySelectorAll('input[type="checkbox"]:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.docId);

            if (selectedIds.length === 0) {
                setStatus('Nenhum item selecionado para exclusão.', 'error', removalStatusMessage);
                return;
            }
            
            if (!confirm(`Tem certeza que deseja EXCLUIR ${selectedIds.length} itens? Esta ação é irreversível!`)) {
                return;
            }

            deleteSelectedBtn.disabled = true;
            deleteSelectedBtn.textContent = `Excluindo ${selectedIds.length} itens...`;
            clearRemovalStatus();

            let successCount = 0;
            let errorCount = 0;
            
            // Cria um array de promessas de exclusão
            const deletePromises = selectedIds.map(async (id) => {
                try {
                    const docRef = doc(db, 'content', id);
                    await deleteDoc(docRef);
                    successCount++;
                } catch (error) {
                    console.error(`Erro ao excluir documento ${id}: `, error);
                    errorCount++;
                }
            });
            
            // Espera todas as exclusões terminarem
            await Promise.all(deletePromises);
            
            // Atualiza o status e a lista
            if (errorCount === 0) {
                setStatus(`Sucesso! ${successCount} item(s) excluído(s).`, 'success', removalStatusMessage);
            } else if (successCount > 0) {
                setStatus(`Excluído: ${successCount}. Erro: ${errorCount}. Verifique as permissões de exclusão.`, 'error', removalStatusMessage);
            } else {
                 setStatus(`Falha total: ${errorCount} erros. Verifique as regras de exclusão do Firestore.`, 'error', removalStatusMessage);
            }

            deleteSelectedBtn.disabled = false;
            deleteSelectedBtn.textContent = 'Excluir Itens Selecionados';
            fetchContentList(); // Recarrega a lista
        }
        
        // --- INICIALIZAÇÃO E HANDLERS DE EVENTO ---
        
        document.addEventListener('DOMContentLoaded', () => {
            // Handlers de Login/Logout
            passwordLoginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // NOVO: Adiciona o listener para atualizar as categorias ao mudar o tipo de conteúdo
            contentType.addEventListener('change', updateCategories);
            
            // Handlers da Tela de Remoção
            openRemovalBtn.addEventListener('click', () => {
                if(isAuthenticated) {
                    showScreen('removal-screen');
                }
            });
            closeRemovalBtn.addEventListener('click', () => showScreen('admin-form-screen'));
            deleteSelectedBtn.addEventListener('click', deleteSelectedContent);
            
            // Exibe a tela de login por padrão
            showScreen('auth-screen');
        });

    </script>
</body>
</html>
