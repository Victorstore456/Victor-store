<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victor Store - Painel Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variáveis de Cores */
        :root {
            --primary-bg-white: #F8F9FA; 
            --header-blue: #004b96; 
            --highlight-color: #6DE350; 
            --secondary-highlight-color: #007BFF; 
            --text-color-dark: #212B36; 
            --text-color-light: #F8F9FA; 
            --success-color: #28A745;
            --error-color: #DC3545;
            --shadow-medium: 0 8px 16px rgba(0, 0, 0, 0.1);
            --border-radius-base: 12px;
            --font-family-base: 'Poppins', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--primary-bg-white);
            color: var(--text-color-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background-color: var(--text-color-light);
            border-radius: var(--border-radius-base);
            box-shadow: var(--shadow-medium);
            padding: 30px;
        }

        /* --- Títulos e Botões --- */
        h1 {
            color: var(--header-blue);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-submit {
            background-color: var(--highlight-color);
            color: var(--text-color-dark);
            margin-top: 20px;
        }

        .btn-submit:hover {
            background-color: #55d03d;
            transform: translateY(-1px);
        }
        
        .btn-logout {
            background-color: #6c757d;
            color: var(--text-color-light);
            margin-top: 20px;
        }
        
        .btn-logout:hover {
            background-color: #5a6268;
        }

        .btn-google {
            background-color: #4285F4; /* Cor do Google */
            color: var(--text-color-light);
            margin-top: 20px;
        }

        .btn-google:hover {
            background-color: #357ae8;
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- Formulário e Inputs --- */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #CED4DA;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        /* --- Status --- */
        .status-message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .status-message.success {
            background-color: #d4edda;
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-message.error {
            background-color: #f8d7da;
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        /* --- Telas de Estado --- */
        #auth-screen, #admin-form-screen, #loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
        }

        #loading-screen {
            font-size: 1.2rem;
            color: var(--header-blue);
            min-height: 200px; 
            justify-content: center;
            display: none;
        }
        
        #auth-screen {
            padding: 20px 0;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    <!-- Ícones Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>

    <div class="container">
        <h1>Victor Store - Painel Admin</h1>

        <!-- TELA DE CARREGAMENTO -->
        <div id="loading-screen" style="display: flex;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            <p style="margin-top: 15px;">Aguarde...</p>
        </div>
        
        <!-- TELA DE AUTENTICAÇÃO -->
        <div id="auth-screen" style="display: none;">
            <p style="margin-bottom: 20px; font-weight: 500;">Faça login para acessar o painel de administração:</p>
            <button class="btn btn-google" id="google-sign-in-btn">
                <!-- Ícone do Google (SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.61 20.08v3.52H48c-1.63 7.85-8.54 13.5-16.39 13.5-9.82 0-17.76-7.94-17.76-17.76S21.79 5.59 31.61 5.59c4.78 0 8.95 1.8 12.21 4.98l-3.32 3.29c-2.31-2.22-5.32-3.66-8.89-3.66-6.72 0-12.18 5.46-12.18 12.18s5.46 12.18 12.18 12.18c7.32 0 11.83-4.7 12.13-11.75z"/><path fill="#FF3D00" d="M6.39 6.39v35.22h35.22V6.39H6.39z"/></svg>
                Entrar com Google
            </button>
        </div>

        <!-- TELA: FORMULÁRIO ADMIN -->
        <div id="admin-form-screen" style="display: none;">
            <div style="font-weight: 600; margin-bottom: 20px; color: var(--highlight-color);" id="welcome-message"></div>
            
            <form id="content-form">
                
                <div class="form-group">
                    <label for="content-type">Tipo de Conteúdo</label>
                    <select id="content-type" required>
                        <option value="">-- Selecione o Tipo --</option>
                        <option value="app">Aplicativo (APK)</option>
                        <option value="music">Música</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="content-name">Nome do Item</label>
                    <input type="text" id="content-name" placeholder="Ex: App de Editor de Fotos ou Música Nova" required>
                </div>

                <div class="form-group">
                    <label for="content-description">Descrição Curta (Máx 50 caracteres)</label>
                    <input type="text" id="content-description" placeholder="Ex: O melhor app de edição" maxlength="50" required>
                </div>
                
                <div class="form-group">
                    <label for="content-full-description">Descrição Completa</label>
                    <textarea id="content-full-description" rows="5" placeholder="Descrição detalhada para a página de detalhes do item." required></textarea>
                </div>

                <div class="form-group">
                    <label for="download-link">Link de Download (APK ou Música)</label>
                    <input type="url" id="download-link" placeholder="Ex: https://link.para.o.apk/musica.mp3" required>
                </div>

                <div class="form-group">
                    <label for="image-link">Link da Imagem/Ícone</label>
                    <input type="url" id="image-link" placeholder="Ex: https://link.para.o.icone/imagem.png" required>
                </div>

                <button type="submit" class="btn btn-submit" id="submit-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 15-4-2-7 15-2-4 15-7 2-4-7-15z"/></svg>
                    Enviar para Victor Store
                </button>
            </form>
            
            <div id="status-message" class="status-message"></div>
            
            <button class="btn btn-logout" id="logout-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                Sair
            </button>
        </div>
        
    </div>
    
    <!-- CONEXÃO FIREBASE E SCRIPT PRINCIPAL -->
    
    <script type="module">
        
        // --- CONFIGURAÇÃO E IMPORTS FIREBASE ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
        import {
            getAuth,
            GoogleAuthProvider, 
            signInWithPopup, 
            signOut,
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

        
        // Configuração Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAqUbFJRI1CplOQptliKmVZH90LB2AlZus",
            authDomain: "victor-store-42568.firebaseapp.com",
            projectId: "victor-store-42568",
            storageBucket: "victor-store-42568.firebasestorage.app",
            messagingSenderId: "977015403689",
            appId: "1:977015403689:web:724a68bf4f7ff27f3065b8"
        };
        
        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 
        const provider = new GoogleAuthProvider(); 
        const contentCollectionRef = collection(db, 'content');

        // --- REFERÊNCIAS DOM ---
        const loadingScreen = document.getElementById('loading-screen');
        const authScreen = document.getElementById('auth-screen');
        const adminFormScreen = document.getElementById('admin-form-screen');
        const googleSignInBtn = document.getElementById('google-sign-in-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const contentForm = document.getElementById('content-form');
        const submitBtn = document.getElementById('submit-btn');
        const statusMessage = document.getElementById('status-message');
        const welcomeMessage = document.getElementById('welcome-message');

        // Campos do Formulário
        const contentType = document.getElementById('content-type');
        const contentName = document.getElementById('content-name');
        const contentDescription = document.getElementById('content-description');
        const contentFullDescription = document.getElementById('content-full-description');
        const downloadLink = document.getElementById('download-link');
        const imageLink = document.getElementById('image-link');

        // --- FUNÇÕES UTILITÁRIAS E DE EXIBIÇÃO ---
        
        function showScreen(screenId, user = null) {
            loadingScreen.style.display = 'none';
            authScreen.style.display = 'none';
            adminFormScreen.style.display = 'none';

            if (screenId === 'auth-screen') {
                authScreen.style.display = 'flex';
            } else if (screenId === 'admin-form-screen') {
                if (user) {
                    const name = user.displayName ? user.displayName.split(' ')[0] : 'Admin';
                    welcomeMessage.textContent = `Bem-vindo(a), ${name}!`;
                }
                adminFormScreen.style.display = 'flex';
            } else {
                loadingScreen.style.display = 'flex';
            }
            clearStatus();
        }

        function setStatus(message, type = 'error') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
        }
        
        function clearStatus() {
            statusMessage.style.display = 'none';
            statusMessage.textContent = '';
        }
        
        // --- AUTENTICAÇÃO COM GOOGLE ---
        
        async function signInWithGoogle() {
            googleSignInBtn.disabled = true;
            googleSignInBtn.textContent = 'Autenticando...';
            clearStatus();

            try {
                // Abre o pop-up de login do Google
                const result = await signInWithPopup(auth, provider);
                // A UI será atualizada pelo onAuthStateChanged
                
            } catch (error) {
                console.error("Erro no login com Google:", error);
                
                let message = 'Erro ao fazer login. Tente novamente.';
                if (error.code === 'auth/popup-closed-by-user') {
                    message = 'Login cancelado. O pop-up foi fechado.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    message = 'ERRO CRÍTICO: Domínio Não Autorizado. Você DEVE adicionar o endereço onde o painel está rodando na lista de provedores OAuth do Firebase.';
                } else if (error.code === 'auth/operation-not-allowed') {
                    message = 'ERRO CRÍTICO: Login com Google NÃO está ativo no seu projeto Firebase (Firebase Auth > Settings > Sign-in method). Você DEVE ATIVÁ-LO.';
                }
                
                // Exibe o erro na tela de autenticação
                const authErrorContainer = document.getElementById('auth-screen');
                authErrorContainer.insertAdjacentHTML('beforeend', `<div class="status-message error" style="display: block; width: auto; margin-top: 15px; padding: 10px;">${message}</div>`);

            } finally {
                googleSignInBtn.disabled = false;
                googleSignInBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.61 20.08v3.52H48c-1.63 7.85-8.54 13.5-16.39 13.5-9.82 0-17.76-7.94-17.76-17.76S21.79 5.59 31.61 5.59c4.78 0 8.95 1.8 12.21 4.98l-3.32 3.29c-2.31-2.22-5.32-3.66-8.89-3.66-6.72 0-12.18 5.46-12.18 12.18s5.46 12.18 12.18 12.18c7.32 0 11.83-4.7 12.13-11.75z"/><path fill="#FF3D00" d="M6.39 6.39v35.22h35.22V6.39H6.39z"/></svg> Entrar com Google`;
            }
        }
        
        // --- LOGOUT ---
        async function handleLogout() {
            try {
                await signOut(auth);
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
                setStatus("Erro ao sair. Tente novamente.", 'error');
            }
        }

        // --- SUBMISSÃO DO FORMULÁRIO (ADD DOC) ---
        
        contentForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            clearStatus();
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            if (!auth.currentUser) {
                setStatus('Erro: Usuário não autenticado. Por favor, faça login.', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
                return;
            }

            // 1. Coleta e validação dos dados
            const newItem = {
                type: contentType.value,
                name: contentName.value.trim(),
                description: contentDescription.value.trim(),
                fullDescription: contentFullDescription.value.trim(),
                downloadLink: downloadLink.value.trim(),
                image: imageLink.value.trim(),
                createdAt: serverTimestamp(), 
                updatedAt: serverTimestamp(),
                submittedBy: auth.currentUser.email || auth.currentUser.uid 
            };
            
            if (newItem.type === '' || newItem.name === '' || newItem.downloadLink === '' || newItem.image === '' || newItem.description === '' || newItem.fullDescription === '') {
                setStatus('Por favor, preencha todos os campos obrigatórios.', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
                return;
            }

            try {
                // 2. Adiciona o documento no Firestore
                const docRef = await addDoc(contentCollectionRef, newItem);

                setStatus(`Conteúdo "${newItem.name}" (${newItem.type}) adicionado com sucesso! ID: ${docRef.id}`, 'success');
                contentForm.reset(); 
                
            } catch (error) {
                console.error("Erro ao adicionar documento: ", error);
                if (error.code === 'permission-denied') {
                     setStatus(`ERRO: Permissão Negada. Confirme se as regras de segurança do Firestore permitem escrita para usuários autenticados.`, 'error');
                } else {
                    setStatus(`Erro ao salvar no Firestore: ${error.message}`, 'error');
                }
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar para Victor Store';
            }
        });

        // --- INICIALIZAÇÃO E MONITORAMENTO DE ESTADO ---
        
        // 1. Configura os handlers de evento
        document.addEventListener('DOMContentLoaded', () => {
            googleSignInBtn.addEventListener('click', signInWithGoogle);
            logoutBtn.addEventListener('click', handleLogout);
        });

        // 2. Monitora o estado de autenticação (CRUCIAL)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuário logado: mostra o painel de administração
                showScreen('admin-form-screen', user);
            } else {
                // Usuário deslogado: mostra a tela de login
                showScreen('auth-screen');
            }
        });

    </script>
</body>
</html>

