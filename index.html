<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victor Store - Painel Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Variáveis de Cores */
        :root {
            --primary-bg-white: #F8F9FA; 
            --header-blue: #004b96; 
            --highlight-color: #6DE350; 
            --secondary-highlight-color: #007BFF; 
            --text-color-dark: #212B36; 
            --text-color-light: #F8F9FA; 
            --success-color: #28A745;
            --error-color: #DC3545;
            --shadow-medium: 0 8px 16px rgba(0, 0, 0, 0.1);
            --border-radius-base: 12px;
            --font-family-base: 'Poppins', sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--primary-bg-white);
            color: var(--text-color-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 450px;
            background-color: var(--text-color-light);
            border-radius: var(--border-radius-base);
            box-shadow: var(--shadow-medium);
            padding: 30px;
        }
        
        /* Ajuste de container para a tela de remoção */
        #removal-screen.container {
            max-width: 650px;
            padding: 40px;
        }

        /* --- Títulos e Botões --- */
        h1 {
            color: var(--header-blue);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 700;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.1s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-submit {
            background-color: var(--highlight-color);
            color: var(--text-color-dark);
            margin-top: 20px;
        }

        .btn-submit:hover {
            background-color: #55d03d;
            transform: translateY(-1px);
        }
        
        .btn-logout {
            background-color: #6c757d;
            color: var(--text-color-light);
            margin-top: 20px;
        }
        
        .btn-logout:hover {
            background-color: #5a6268;
        }
        
        .btn-login {
            background-color: var(--header-blue);
            color: var(--text-color-light);
            margin-top: 20px;
        }
        .btn-login:hover {
            background-color: #003b7a;
            transform: translateY(-1px);
        }
        
        .btn-delete {
            background-color: var(--error-color);
            color: var(--text-color-light);
            margin-top: 30px;
        }
        .btn-delete:hover {
            background-color: #c9303e;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-highlight-color);
            color: var(--text-color-light);
        }
        .btn-secondary:hover {
            background-color: #0069d9;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* --- Formulário e Inputs --- */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-color-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #CED4DA;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        /* --- Status --- */
        .status-message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .status-message.success {
            background-color: #d4edda;
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-message.error {
            background-color: #f8d7da;
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        /* --- Telas de Estado --- */
        #auth-screen, #admin-form-screen, #loading-screen, #removal-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 100%;
        }
        
        #admin-form-screen {
            display: none; /* Inicia escondido */
        }
        
        #loading-screen {
            font-size: 1.2rem;
            color: var(--header-blue);
            min-height: 200px; 
            justify-content: center;
            display: none;
        }
        
        #auth-screen {
            padding: 20px 0;
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Estilos para a lista de remoção */
        #content-list {
            list-style: none;
            padding: 0;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #CED4DA;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .content-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #E9ECEF;
            text-align: left;
        }
        
        .content-item:last-child {
            border-bottom: none;
        }
        
        .content-item input[type="checkbox"] {
            margin-right: 15px;
            min-width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .item-details {
            flex-grow: 1;
        }
        
        .item-details strong {
            display: block;
            font-weight: 600;
            color: var(--text-color-dark);
        }
        
        .item-details span {
            font-size: 0.85rem;
            color: #6c757d;
        }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <div class="container" id="main-container">
        <h1>Victor Store - Painel Admin</h1>

        <div id="loading-screen" style="display: flex;">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
            <p style="margin-top: 15px;">Aguarde...</p>
        </div>
        
        <div id="auth-screen" style="display: none;">
            <p style="margin-bottom: 20px; font-weight: 500;">Entre com a senha de acesso:</p>
            <form id="password-login-form" style="width: 100%;">
                <div class="form-group">
                    <label for="admin-password">Senha</label>
                    <input type="password" id="admin-password" placeholder="Digite a senha" required>
                </div>
                <button type="submit" class="btn btn-login" id="login-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                    Entrar
                </button>
            </form>
            <div id="login-status-message" class="status-message"></div>
        </div>

        <div id="admin-form-screen">
            <div style="font-weight: 600; margin-bottom: 20px; color: var(--highlight-color);" id="welcome-message">Bem-vindo(a) de volta!</div>
            
            <form id="content-form">
                
                <div class="form-group">
                    <label for="content-type">Tipo de Conteúdo Principal</label>
                    <select id="content-type" required>
                        <option value="">-- Selecione o Tipo --</option>
                        <option value="jogo">Jogo</option>
                        <option value="app_geral">App (Geral)</option>
                        <option value="frp">FRP (Ferramentas de Desbloqueio)</option>
                        <option value="software">Software (PC/Outros)</option>
                    </select>
                </div>

                <div class="form-group" id="category-group" style="display: none;">
                    <label for="content-category">Categoria Específica</label>
                    <select id="content-category" required>
                        <option value="">-- Selecione a Categoria --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="content-name">Nome do Item</label>
                    <input type="text" id="content-name" placeholder="Ex: App de Editor de Fotos ou Música Nova" required>
                </div>

                <div class="form-group">
                    <label for="content-description">Descrição Curta (Máx 50 caracteres)</label>
                    <input type="text" id="content-description" placeholder="Ex: O melhor app de edição" maxlength="50" required>
                </div>
                
                <div class="form-group">
                    <label for="content-full-description">Descrição Completa</label>
                    <textarea id="content-full-description" rows="5" placeholder="Descrição detalhada para a página de detalhes do item." required></textarea>
                </div>

                <div class="form-group">
                    <label for="download-link">Link de Download (APK ou Música)</label>
                    <input type="url" id="download-link" placeholder="Ex: https://link.para.o.apk/musica.mp3" required>
                </div>

                <div class="form-group">
                    <label for="image-link">Link da Imagem/Ícone</label>
                    <input type="url" id="image-link" placeholder="Ex: https://link.para.o.icone/imagem.png" required>
                </div>

                <button type="submit" class="btn btn-submit" id="submit-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 15-4-2-7 15-2-4 15-7 2-4-7-15z"/></svg>
                    Enviar para Victor Store
                </button>
            </form>
            <div id="status-message" class="status-message"></div>

            <div style="margin-top: 40px; border-top: 1px solid #CED4DA; padding-top: 30px; width: 100%;">
                <h2 style="font-size: 1.2rem; margin-bottom: 20px;">Controle de Versão do Aplicativo (Atualização Forçada)</h2>
                <div id="current-version-display" style="margin-bottom: 15px; font-weight: 500; text-align: left;">
                    Versão Atual do Site no Servidor: <span id="server-ui-version" style="color: var(--highlight-color);">Carregando...</span>
                </div>
                <form id="version-control-form">
                    <div class="form-group">
                        <label for="new-ui-version" style="text-align: left;">Próxima Versão (Deve ser maior que a atual! Ex: 1.1, 1.2)</label>
                        <input type="number" id="new-ui-version" step="0.1" placeholder="Ex: 1.1" required>
                    </div>
                    <button type="submit" class="btn btn-secondary" id="update-version-btn" style="background-color: #009688;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud-upload"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.5"/><path d="M12 21v-8"/><path d="m16 16-4-4-4 4"/></svg>
                        Lançar Atualização de UI
                    </button>
                </form>
                <div id="version-status-message" class="status-message"></div>
            </div>
            
            <div style="margin-top: 40px; border-top: 1px solid #CED4DA; padding-top: 30px; width: 100%;">
                <h2 style="font-size: 1.2rem; margin-bottom: 20px;">Controle de Versão do APK (Atualização In-App)</h2>
                
                <div id="current-apk-display" style="margin-bottom: 15px; font-weight: 500; text-align: left;">
                    Versão Atual do APK no Servidor: <span id="server-apk-version" style="color: var(--secondary-highlight-color);">Carregando...</span>
                    <div style="font-size: 0.85rem; color: #6c757d; margin-top: 5px;">Link de Download Atual: <a href="#" id="server-apk-link" target="_blank" style="color: var(--secondary-highlight-color); word-break: break-all;">Carregando...</a></div>
                </div>
                
                <form id="apk-version-control-form">
                    <div class="form-group">
                        <label for="new-apk-version" style="text-align: left;">Nova Versão do APK (Ex: 2.0.1, 3.0)</label>
                        <input type="text" id="new-apk-version" placeholder="Ex: 2.0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="new-apk-link" style="text-align: left;">Link Direto do Novo APK (.apk)</label>
                        <input type="url" id="new-apk-link" placeholder="Ex: https://storage.firebase.com/seuapp-v2.0.1.apk" required>
                    </div>
                    
                    <button type="submit" class="btn btn-submit" id="update-apk-btn" style="background-color: var(--secondary-highlight-color);">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                        Lançar Novo APK
                    </button>
                </form>
                
                <div id="apk-version-status-message" class="status-message"></div>
            </div>
            
            <div style="margin-top: 40px; border-top: 1px solid #CED4DA; padding-top: 30px; width: 100%;">
                <h2 style="font-size: 1.2rem; margin-bottom: 20px;">Lançamento de Notificação In-App (Menu Hamburguer)</h2>
                
                <p id="notification-info" style="margin-bottom: 15px; font-size: 0.9rem; color: #6c757d; text-align: left;">
                    Ao enviar, o ponto vermelho aparecerá no menu hamburguer de todos os usuários até que eles cliquem no link da notificação.
                </p>

                <form id="notification-control-form">
                    <div class="form-group">
                        <label for="notification-link" style="text-align: left;">Link de Ação da Notificação (Onde o usuário será levado)</label>
                        <input type="url" id="notification-link" placeholder="Ex: https://link.para.o.apk" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notification-message" style="text-align: left;">Texto da Notificação (Mostrado no menu)</label>
                        <input type="text" id="notification-message" value="Nova atualização, clique aqui para baixar" required>
                    </div>
                    
                    <button type="submit" class="btn btn-submit" id="send-notification-btn" style="background-color: #F7A700;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring"><path d="M10 2c-3.1 0-6 1.8-6 6v4.5l-2 2v2h20v-2l-2-2V8c0-4.2-3.4-6-6-6Z"/><path d="M10 2c0 2.2 1.8 4 4 4"/><circle cx="12" cy="18" r="1"/><path d="M12 21a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2Z"/></svg>
                        Enviar Notificação Agora
                    </button>
                </form>
                
                <div id="notification-status-message" class="status-message"></div>
            </div>
            
            <div style="margin-top: 30px; display: flex; gap: 10px;">
                <button class="btn btn-secondary" id="open-removal-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                    Remover Itens
                </button>
                <button class="btn btn-logout" id="logout-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                    Sair
                </button>
            </div>
        </div>

        <div class="container" id="removal-screen" style="display: none; max-width: 650px;">
            <h2 style="font-size: 1.5rem; color: var(--error-color); margin-bottom: 20px;">Remoção de Conteúdo</h2>
            <p style="margin-bottom: 10px; text-align: left; width: 100%;">Selecione os itens a serem removidos do Firestore:</p>
            <button class="btn btn-secondary" id="load-content-btn" style="margin-top: 0; background-color: #f7a700;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-cw"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.76 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.76-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>
                Carregar Lista Completa
            </button>
            
            <ul id="content-list" style="margin-top: 20px;">
                </ul>

            <button class="btn btn-delete" id="delete-selected-btn" disabled>
                Excluir Itens Selecionados (0)
            </button>
            <div id="removal-status-message" class="status-message"></div>
            <button class="btn btn-logout" id="close-removal-btn" style="margin-top: 20px;">Voltar ao Painel</button>
        </div>
    </div>

    <script type="module">
        // Importações e Configuração do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            doc,       
            getDoc,    
            setDoc,    
            updateDoc, 
            getDocs,
            deleteDoc
        } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        // CONFIGURAÇÃO - Substitua com seus dados reais
        const firebaseConfig = {
            apiKey: "AIzaSyAqUbFJRI1CplOQptliKmVZH90LB2AlZus",
            authDomain: "victor-store-42568.firebaseapp.com",
            projectId: "victor-store-42568",
            storageBucket: "victor-store-42568.firebasestorage.app",
            messagingSenderId: "977015403689",
            appId: "1:977015403689:web:724a68bf4f7ff27f3065b8"
        };
        // Senha de Acesso (AJUSTADA COM SUA SENHA: 857629056)
        const ADMIN_PASSWORD = "857629056"; 

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let isAuthenticated = localStorage.getItem('isAuthenticated') === 'true';

        // Mapeamentos de categorias para o formulário
        const categoriesMap = {
            'jogo': ['Ação', 'Aventura', 'Puzzle', 'Estratégia', 'Simulação'],
            'app_geral': ['Produtividade', 'Redes Sociais', 'Ferramentas', 'Entretenimento'],
            'frp': ['Samsung', 'Motorola', 'Xiaomi', 'Geral'],
            'software': ['Sistema Operacional', 'Utilitários', 'Segurança', 'Design']
        };

        // --- REFERÊNCIAS DOM ---
        const authScreen = document.getElementById('auth-screen');
        const adminFormScreen = document.getElementById('admin-form-screen');
        const loadingScreen = document.getElementById('loading-screen');
        const removalScreen = document.getElementById('removal-screen');
        const passwordLoginForm = document.getElementById('password-login-form');
        const adminPasswordInput = document.getElementById('admin-password');
        const loginStatusMessage = document.getElementById('login-status-message');
        const logoutBtn = document.getElementById('logout-btn');
        const contentForm = document.getElementById('content-form');
        const contentType = document.getElementById('content-type');
        const contentCategory = document.getElementById('content-category');
        const categoryGroup = document.getElementById('category-group');
        const statusMessage = document.getElementById('status-message');
        const submitBtn = document.getElementById('submit-btn');
        const serverUIVersion = document.getElementById('server-ui-version');
        const versionControlForm = document.getElementById('version-control-form');
        const newUIVersion = document.getElementById('new-ui-version');
        const versionStatusMessage = document.getElementById('version-status-message');
        
        // Referências da Tela de Remoção
        const openRemovalBtn = document.getElementById('open-removal-btn');
        const closeRemovalBtn = document.getElementById('close-removal-btn');
        const contentList = document.getElementById('content-list');
        const deleteSelectedBtn = document.getElementById('delete-selected-btn');
        const removalStatusMessage = document.getElementById('removal-status-message');

        // Referências do APK
        const apkVersionControlForm = document.getElementById('apk-version-control-form');
        const serverApkVersion = document.getElementById('server-apk-version');
        const serverApkLink = document.getElementById('server-apk-link');
        const newApkVersion = document.getElementById('new-apk-version');
        const newApkLink = document.getElementById('new-apk-link');
        const apkVersionStatusMessage = document.getElementById('apk-version-status-message');
        
        // NOVO: Referências da Notificação
        const notificationControlForm = document.getElementById('notification-control-form');
        const notificationLink = document.getElementById('notification-link');
        const notificationMessage = document.getElementById('notification-message');
        const notificationStatusMessage = document.getElementById('notification-status-message');


        // --- FUNÇÕES DE UTILIDADE ---

        function showScreen(screenId) {
            authScreen.style.display = 'none';
            adminFormScreen.style.display = 'none';
            loadingScreen.style.display = 'none';
            removalScreen.style.display = 'none';

            if (screenId === 'auth-screen') {
                authScreen.style.display = 'flex';
                document.getElementById('main-container').style.maxWidth = '450px';
            } else if (screenId === 'admin-form-screen') {
                adminFormScreen.style.display = 'flex';
                document.getElementById('main-container').style.maxWidth = '450px';
            } else if (screenId === 'loading-screen') {
                loadingScreen.style.display = 'flex';
                document.getElementById('main-container').style.maxWidth = '450px';
            } else if (screenId === 'removal-screen') {
                removalScreen.style.display = 'flex';
                document.getElementById('main-container').style.maxWidth = '650px';
                fetchContentList(); 
            }
        }

        function setStatus(message, type, targetElement) {
            targetElement.textContent = message;
            targetElement.className = `status-message ${type}`;
            targetElement.style.display = 'block';
            setTimeout(() => { targetElement.style.display = 'none'; }, 5000);
        }

        function updateCategories() {
            const selectedType = contentType.value;
            contentCategory.innerHTML = '<option value="">-- Selecione a Categoria --</option>';

            if (selectedType && categoriesMap[selectedType]) {
                categoriesMap[selectedType].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.toLowerCase().replace(/\s/g, '_');
                    option.textContent = category;
                    contentCategory.appendChild(option);
                });
                categoryGroup.style.display = 'block';
            } else {
                categoryGroup.style.display = 'none';
            }
        }

        // --- FUNÇÕES DE FIREBASE (CRUD) ---
        
        // 1. LOGIN
        async function handleLogin(e) {
            e.preventDefault();
            const password = adminPasswordInput.value;
            const loginBtn = document.getElementById('login-btn');

            loginBtn.disabled = true;
            loginBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Entrando...';

            await new Promise(resolve => setTimeout(resolve, 1000)); 

            if (password === ADMIN_PASSWORD) {
                isAuthenticated = true;
                localStorage.setItem('isAuthenticated', 'true');
                setStatus('Login bem-sucedido!', 'success', loginStatusMessage);
                adminPasswordInput.value = '';
                
                showScreen('loading-screen'); 
                await Promise.all([
                    fetchServerVersion(),
                    fetchApkVersion()
                ]);
                showScreen('admin-form-screen');

            } else {
                setStatus('Senha incorreta. Tente novamente.', 'error', loginStatusMessage);
            }
            
            loginBtn.disabled = false;
            loginBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg> Entrar';
        }

        // 2. LOGOUT
        function handleLogout() {
            isAuthenticated = false;
            localStorage.removeItem('isAuthenticated');
            showScreen('auth-screen');
        }

        // 3. ENVIAR CONTEÚDO
        async function handleContentSubmit(e) {
            e.preventDefault();
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Enviando...';

            const name = document.getElementById('content-name').value;
            const type = contentType.value;
            const category = contentCategory.value;
            const description = document.getElementById('content-description').value;
            const fullDescription = document.getElementById('content-full-description').value;
            const downloadLink = document.getElementById('download-link').value;
            const imageLink = document.getElementById('image-link').value;
            
            const contentData = {
                name: name,
                type: type, 
                category: category,
                description: description,
                full_description: fullDescription,
                download_link: downloadLink,
                image_link: imageLink,
                createdAt: Date.now(), // Para ordenação
                is_featured: false, 
                downloads: 0 
            };

            try {
                const newDocRef = doc(collection(db, 'content')); 
                await setDoc(newDocRef, contentData);

                setStatus(`Sucesso! "${name}" enviado com o ID: ${newDocRef.id}`, 'success', statusMessage);
                contentForm.reset(); 
                updateCategories(); 
            } catch (error) {
                console.error("Erro ao enviar documento: ", error);
                setStatus(`Erro ao enviar: ${error.message}`, 'error', statusMessage);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 15-4-2-7 15-2-4 15-7 2-4-7-15z"/></svg> Enviar para Victor Store';
            }
        }
        
        // 4. LER VERSÃO DO SITE (UI)
        async function fetchServerVersion() {
            try {
                const settingsDocRef = doc(db, 'settings', 'config'); 
                const docSnap = await getDoc(settingsDocRef);

                if (docSnap.exists() && docSnap.data().web_ui_version) {
                    serverUIVersion.textContent = docSnap.data().web_ui_version;
                    newUIVersion.value = docSnap.data().web_ui_version; 
                } else {
                    serverUIVersion.textContent = '1.0';
                    newUIVersion.value = '1.0';
                }
            } catch (error) {
                console.error("Erro ao carregar versão do servidor:", error);
                setStatus('Erro ao carregar a versão atual do site.', 'error', versionStatusMessage);
            }
        }

        // 5. ATUALIZAR VERSÃO DO SITE (UI)
        async function handleVersionUpdate(e) {
            e.preventDefault();
            const version = parseFloat(newUIVersion.value);

            if (isNaN(version)) {
                setStatus('Versão inválida. Use um número (ex: 1.1).', 'error', versionStatusMessage);
                return;
            }

            const updateBtn = document.getElementById('update-version-btn');
            updateBtn.disabled = true;
            updateBtn.textContent = 'Lançando...';

            try {
                const settingsDocRef = doc(db, 'settings', 'config');
                await updateDoc(settingsDocRef, {
                    web_ui_version: version
                });

                setStatus(`Sucesso! Versão de UI atualizada para ${version}.`, 'success', versionStatusMessage);
                fetchServerVersion(); 
            } catch (error) {
                console.error("Erro ao atualizar versão de UI:", error);
                setStatus(`Erro ao atualizar: ${error.message}`, 'error', versionStatusMessage);
            } finally {
                updateBtn.disabled = false;
                updateBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cloud-upload"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.5"/><path d="M12 21v-8"/><path d="m16 16-4-4-4 4"/></svg> Lançar Atualização de UI';
            }
        }
        
        // 6. LER VERSÃO ATUAL DO APK NO FIREBASE
        async function fetchApkVersion() {
            try {
                const settingsDocRef = doc(db, 'settings', 'config'); 
                const docSnap = await getDoc(settingsDocRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    serverApkVersion.textContent = data.apk_version || 'N/A';
                    serverApkLink.textContent = data.apk_link || 'N/A';
                    serverApkLink.href = data.apk_link || '#';
                    
                    newApkVersion.value = data.apk_version || '1.0.0';
                } else {
                    serverApkVersion.textContent = '1.0.0 (Inicial)';
                    serverApkLink.textContent = 'N/A';
                    newApkVersion.value = '1.0.0'; 
                }
            } catch (error) {
                console.error("Erro ao carregar versão do APK:", error);
                setStatus('Erro ao carregar a versão atual do APK.', 'error', apkVersionStatusMessage);
            }
        }


        // 7. ESCREVER NOVA VERSÃO E LINK NO FIREBASE (APK)
        async function handleApkVersionUpdate(e) {
            e.preventDefault();
            const version = newApkVersion.value.trim();
            const link = newApkLink.value.trim();

            if (!version || !link) {
                setStatus('Preencha a Nova Versão e o Link do APK.', 'error', apkVersionStatusMessage);
                return;
            }
            
            const updateBtn = document.getElementById('update-apk-btn');
            updateBtn.disabled = true;
            updateBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Lançando...';

            try {
                const settingsDocRef = doc(db, 'settings', 'config');
                
                await updateDoc(settingsDocRef, {
                    apk_version: version,
                    apk_link: link,
                    last_apk_release: new Date().toISOString() 
                });

                setStatus(`Sucesso! APK versão ${version} lançado.`, 'success', apkVersionStatusMessage);
                
                await fetchApkVersion();
                
            } catch (error) {
                console.error("Erro ao atualizar versão do APK:", error);
                setStatus(`Erro ao lançar APK: ${error.message}`, 'error', apkVersionStatusMessage);
            } finally {
                updateBtn.disabled = false;
                updateBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-zap"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg> Lançar Novo APK';
            }
        }
        
        // 8. ENVIAR NOTIFICAÇÃO
        async function handleNotificationSend(e) {
            e.preventDefault();
            const link = notificationLink.value.trim();
            const message = notificationMessage.value.trim();
            
            if (!link) {
                setStatus('O link da notificação é obrigatório.', 'error', notificationStatusMessage);
                return;
            }
            
            const sendBtn = document.getElementById('send-notification-btn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Enviando...';

            try {
                const newNotificationId = Date.now().toString(); 
                const updateDocRef = doc(db, 'settings', 'latest_update');
                
                await setDoc(updateDocRef, {
                    id: newNotificationId, 
                    link: link,           
                    message: message,     
                    timestamp: newNotificationId
                });

                setStatus(`Sucesso! Notificação (ID: ${newNotificationId}) enviada para todos os usuários.`, 'success', notificationStatusMessage);
                notificationControlForm.reset();
                notificationMessage.value = 'Nova atualização, clique aqui para baixar'; // Reseta o valor padrão
                
            } catch (error) {
                console.error("Erro ao enviar notificação:", error);
                setStatus(`Erro ao enviar notificação: ${error.message}`, 'error', notificationStatusMessage);
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring"><path d="M10 2c-3.1 0-6 1.8-6 6v4.5l-2 2v2h20v-2l-2-2V8c0-4.2-3.4-6-6-6Z"/><path d="M10 2c0 2.2 1.8 4 4 4"/><circle cx="12" cy="18" r="1"/><path d="M12 21a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2Z"/></svg> Enviar Notificação Agora';
            }
        }
        
        // 9. LISTAR CONTEÚDO PARA REMOÇÃO
        async function fetchContentList() {
             document.getElementById('load-content-btn').disabled = true;
             contentList.innerHTML = '<li style="text-align:center; padding: 15px;">Carregando...</li>';
             removalStatusMessage.style.display = 'none';

            try {
                const contentColRef = collection(db, 'content');
                const contentSnapshot = await getDocs(contentColRef);
                
                let html = '';
                contentSnapshot.forEach(doc => {
                    const data = doc.data();
                    const id = doc.id;
                    html += `
                        <li class="content-item">
                            <input type="checkbox" data-id="${id}" onchange="checkSelection()">
                            <div class="item-details">
                                <strong>${data.name}</strong>
                                <span>Tipo: ${data.type} | Categoria: ${data.category} | ID: ${id}</span>
                            </div>
                        </li>
                    `;
                });

                contentList.innerHTML = html || '<li style="text-align:center; padding: 15px; color: #6c757d;">Nenhum conteúdo encontrado.</li>';
                checkSelection();

            } catch (error) {
                console.error("Erro ao carregar lista de conteúdo:", error);
                setStatus('Erro ao carregar lista para remoção. Cheque a conexão.', 'error', removalStatusMessage);
            } finally {
                 document.getElementById('load-content-btn').disabled = false;
            }
        }
        
        // 10. ATUALIZAR CONTAGEM DE SELEÇÃO
        function checkSelection() {
            const checkboxes = contentList.querySelectorAll('input[type="checkbox"]');
            let count = 0;
            checkboxes.forEach(cb => {
                if (cb.checked) count++;
            });
            
            deleteSelectedBtn.textContent = `Excluir Itens Selecionados (${count})`;
            deleteSelectedBtn.disabled = count === 0;
        }
        window.checkSelection = checkSelection; // Expõe a função para o HTML

        // 11. DELETAR CONTEÚDO
        async function deleteSelectedContent() {
            if (!confirm("Tem certeza que deseja EXCLUIR os itens selecionados? Esta ação é IRREVERSÍVEL.")) return;

            const checkboxes = contentList.querySelectorAll('input[type="checkbox"]:checked');
            if (checkboxes.length === 0) return;

            deleteSelectedBtn.disabled = true;
            deleteSelectedBtn.textContent = 'Excluindo...';
            
            let successCount = 0;
            let errorCount = 0;

            for (const checkbox of checkboxes) {
                const id = checkbox.getAttribute('data-id');
                try {
                    await deleteDoc(doc(db, 'content', id));
                    successCount++;
                } catch (error) {
                    console.error(`Erro ao excluir documento ${id}:`, error);
                    errorCount++;
                }
            }

            if (errorCount === 0) {
                setStatus(`Sucesso! ${successCount} item(s) removido(s).`, 'success', removalStatusMessage);
            } else if (successCount > 0) {
                 setStatus(`Concluído com ${successCount} sucessos e ${errorCount} erro(s). Verifique as permissões de exclusão.`, 'error', removalStatusMessage);
            } else {
                 setStatus(`Falha total: ${errorCount} erros. Verifique as regras de exclusão do Firestore.`, 'error', removalStatusMessage);
            }

            deleteSelectedBtn.disabled = false;
            fetchContentList(); // Recarrega a lista
        }
        
        // --- INICIALIZAÇÃO E HANDLERS DE EVENTO ---
        
        document.addEventListener('DOMContentLoaded', async () => {
            // Handlers de Login/Logout
            passwordLoginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Handlers do Formulário de Conteúdo e Versão
            contentForm.addEventListener('submit', handleContentSubmit);
            contentType.addEventListener('change', updateCategories);
            versionControlForm.addEventListener('submit', handleVersionUpdate);
            apkVersionControlForm.addEventListener('submit', handleApkVersionUpdate); 
            
            // Handlers da Notificação
            notificationControlForm.addEventListener('submit', handleNotificationSend);
            
            // Handlers da Tela de Remoção
            openRemovalBtn.addEventListener('click', () => {
                if(isAuthenticated) {
                    showScreen('removal-screen');
                }
            });
            closeRemovalBtn.addEventListener('click', () => showScreen('admin-form-screen'));
            deleteSelectedBtn.addEventListener('click', deleteSelectedContent);
            document.getElementById('load-content-btn').addEventListener('click', fetchContentList);
            
            // CORREÇÃO: Verifica a autenticação ao carregar
            if (isAuthenticated) {
                // Se autenticado, carrega os dados e mostra o painel
                showScreen('loading-screen'); 
                
                await Promise.all([
                    fetchServerVersion(),
                    fetchApkVersion()
                ]);
                
                showScreen('admin-form-screen');

            } else {
                // Se não autenticado, mostra a tela de login
                showScreen('auth-screen');
            }
        });

    </script>
</body>
                        </html>
